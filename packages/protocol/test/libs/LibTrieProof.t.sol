// SPDX-License-Identifier: MIT
pragma solidity 0.8.24;

import "../TaikoTest.sol";
import "../../contracts/libs/LibTrieProof.sol";

contract TestLibTrieProof is TaikoTest {
    function test_verifyMerkleProof() public {
        // Not needed for now, but leave it as is.
        //uint64 chainId = 11_155_111; // Created the proofs on a deployed Sepolia
        // contract, this is why this chainId.
        // Actually this is the messageHash i sent (obviously just a made up bytes32!)
        // Not needed for now, but leave it as is.
        //bytes32 signalSent = 0x21761f7cd1af3972774272b39a0f4602dbcd418325cddb14e156b4bb073d52a8;
        // //Actually a messageHash
        // This one is the "sender app" aka the source bridge but i mocked it for now to be an EOA
        // (for slot calculation)
        address addr = 0x17DF3c450D1dC61558ecA7B10e4bBC8ddcdB1f28;
        // This is the slot i queried the eth_getProof on Sepolia for blockheight: 0x5000B5
        bytes32 slot = 0xfa2ef1bab164a0522c2c110bbea1a54ac6399d3ba24437480c29947143a5402e;
        // This is the stateRoot at blockheight: 0x5000B5 (Sepolia!)
        bytes32 stateRoot = 0x90c5f343ed98545ad5ad4e840492e1008218c0ea92f8fd74a826aaf4c477a3fe;
        // This is the stateRoot just RLP encoded with
        // https://toolkit.abdk.consulting/ethereum#key-to-address,rlp
        // Not needed for now but leave it as is
        //bytes memory stateRootRLPEncoded =
        // hex"e1a090c5f343ed98545ad5ad4e840492e1008218c0ea92f8fd74a826aaf4c477a3fe";

        bytes[] memory accountProof = new bytes[](8);
        // eth_getProof responds some bytes
        accountProof[0] =
            hex"f90211a01564179a33d2ff80c3618ab74314aad556cb7652c2d51f7a3aff3a787ecdb29ea03bd6509773c4530091e420ef4921beef2be63ad2429b6e12ba5d7a7f9a6da270a090be43dc028d9eb13a63b5799782f30928e6882b328ab845f320e1eb138d7962a026633ae06c23cd30c5e1cc91cfd7be03652cb9c853fa42538803c8eb631e920fa0711616cf812d7ed5f308b2822bffc5038edac8abedb0f7339c9933387472b495a09266ec8cec3b85e1ea194e79c73a4b2ecc122abffa356b575c31af7e9d3b6921a0a16f884fe19eeaefb8eeb2f017f6ecb24ee5822d5b3bc4be98bcfe374a910761a07973653d008e00cebcc3794f8221fa530d9a18ce77331a3e473e8dc3735943d9a0bc31a4cd1ab5c4ff0bd12f6ffc12f5ef19897df9addc478aa06b223d3087ef9da059aec5d8753109a5893d67ec742b2b51703ecf5920e4947007a6c77265ac41f9a09c0af28e7444278ab0b478870fa98c9f37e9d19681023f8e039f3ce67492e707a008395a6c64c1c76a1e655a28419504519e9957251e83501eef6093971f937c19a04f2a4e14fe7bbf05ea2b75de2bfe95fd33d2c86ff554293ebdf09da7da579cd5a0816ed8d0b69fce577f3c70eceebe8634387716d91a1edc4b3cc9d5feea31ba94a0a270d82ecded0d0712336be6e078794e533721b40698c9b5165b6c420a8a8545a0bcfbc71cc6ee796c58ef28f0d0e453fc08f6326c1891b51512e19af5f4842ffe80";
        accountProof[1] =
            hex"f90211a0c441ffc1fe3662f328ca995e9cad90cecf26ad98028846b7a1bdb6fe60aa8419a058336ba27c2e0feb5bd8bdeea62ebe54fc4cc05e2376f69e1c721b1cd9098498a07b847e55c107bd976b5984ea7d97d39c68573ae74afd82d4ab9d857cb44e6f82a05f5c1810a0178191798266d171f2f9f9711f5116c5dc4ecccbc29642a24b1873a01da99f321b183e1a2068ac0fd57dccbd637b3fa91b060a80c836ce1ea79fcae0a0f8cf0f8299146bf9d1ec0b8932ddc23ec29cd61daf5cdbe704a5c90f31f0d60ca0407441445132919ff986f169f24e82ce53fe15a444a674ab1604f0924efdd51da0313be5d2f630a30f414aed4012bbe081e55853a55209a3a83045b62f10d74ad2a0ab4a1665cc9ac1dc2f87d98c55e9b893acf84e592635d359a83d0e14181a933da0e4ed4ac12b93b12016ae1c0fd62e6a15b01e617779e8611c27ce22b0b5e78d68a0852127e581d41ec5c58d6a5ccb1b0e7ae90553575b0d9ffb2ac847515671c80fa01ec12bc1938419bebfdc17ed6d10d456fe31202f2dd1534e9bc6b78c95e2b358a000e5a67fdc3cc307a3244b77ddb504867a2cfb0cc9a614a47452d8cfad011af4a0a222a375f0b35461137d84e1beb8cc0e842ea7194784286b0426d80e04ce0ee6a04dc890b4343e041888128a5185860e039b82636d328c52f630007339d445fc0aa00619a2c3c30245bef0821c9f85bc3b79ee2b7f895a4de79ad57f42add8f8cc8d80";
        accountProof[2] =
            hex"f90211a02b8838e8f55f133d202a53a8b8d9243d936f43b636e8edf4cead5028150ba4bda0199e1c6b8025bdb25824acf47c79f2cb46e9912eea4c7951b1841e6831361cf7a03f9cf217c04256b4b8d32218e998e34a2bb16c17aec758811d9cf2b2510a50a0a06a04facdefe440e0d78718bee9ac31d6693d197ea44bb324156d3bcbdc601763a0d30849e23529944c1763e9de2d3ae6d229b4310bcb2415dec58e5375d04d23efa0a4013ee6afb6af932f3e2d126fbe53f656be59f27df7c700099c91e2a65e2bd3a0233ef3fbc0234cbcb9f76ad4ece6c2f50e480e873226f8f8cef2851d10a7ee33a0b5d1dc30ea1bad8ac548ffd9ac408eabb033f2fcf8d3c1780da97180d89f5997a0a4192803a6131538e307b331f9f842b2302d17492f37537a56a63c36eb01b408a06087dc2726b6a21a4d06d7d73b988925cf3ba2c898d442024468a52f8a4010a8a0bfa291361ed2810c2f8ab0eee7fd894e5915e8ad2d12739d4f380466dc3c7f55a08becd8c73f80d6073df6cceb89e796e669744aa852ce13c7b367fe60c2b34d04a012c2d1a15f1bf98ad00cd0eb061a42eaaf0015a5f4c41a894f249c9a3afc3560a0fef566b4ad9fa37ee9ae59f880f4bb38958c8a62f26ae3668f1dbda3e9fd3b05a0702301629db7bdddcc00dbd348adbcffc890bb1c80fe6ef7a996363adc89770da068b975b9b36fc59378c54d5dd868e53ea8a59248da1dc6c4576d9f781913cd7880";
        accountProof[3] =
            hex"f90211a0d98672296e62b8aba7e20671ca0476e58efc4ad0c40480e9ced84696bbfa56a8a0d2c53384b6e3b1b3088fcd412af98f85a52b882914a35adb2aa56cd3484997ada09015daa671fe301f656b0ed4f4f2172d683dae40113979a3f710145106031767a00d055b96c4f5804b7d3e4b8159d72bd84ca9e8b4547b504fe2a9933b4359a2d4a0d2560c909a3b2cc465480d1815b06c613d7a2ae7f6c1f00027cf4a57cdc282d7a0c29b7764bdd0df90b1fe350b488ffe69c3c4202f1712c77aab4fa2e0103ae673a06ca16b3f2b111bb14b8b52d36b85b7df2dada9796c2dd0b13f293149cb3e38fba0219ab02566d6474fa0621669616f97f7be79e1cb5886bc75be99be4984bd978ca0d103757173ada974a0f4996e3191ebce8f3ddc61c9db536ff7389c010b03e536a0f65268a6de255bde8ea97282e9f7a858b15b5bde5b9cde5b654c19cd909231f8a06c3ee37ad1762f6fb9da2b3efec779a61036f76b4c97b3ba8ea1339cfc76393ea09b28c2f98e0eedafa97d733d468c1d7a505f8d6b544bbbaf990cdd4781ee765ea0eeda6a2e3dd383ab103d9c14656df77a6b05a566338745325edb03ab344c7404a0ca35c2b85039e6a1fce323649d015876c13702faa510cee4f4a7efaac5456185a00a0e83158f3c174485b6b6ff64f793d0bd578215a685acc86b002bcc99c99f9ba0fd0d0c3d0f27d3e7bc63462df509157e56d03e310ee26a60a4f7dfa87a9e0c2080";
        accountProof[4] =
            hex"f90211a0f69c09b524b3e7a97fe238809583b7b68f41443a76c0f5d689b371c1df513fc1a0d0f0bcbbd6dae7bd8dd9ba196a34e81c7cc9fea6ac4894a69ec2b5b7bdae2f01a081975fbe995c9a7a55b8e846a70be0d6695c8529b7f564448bf64f2ef25d8c5ca02cd43f9e6fafbe13cc8e845d8c19b51ddc62610119948c635c7e1c9c9998dc22a03b4e6dfe0edcdfbb0b8252f97cc6d2a11f25c571b093cc53aca88d38a94bf827a0e9b70cbde13f142578dba52a5a862122a2332e15c148edda2b9b419528ee9231a014ff7fc46869c016d4ac3b0487a59bf269a4d80fd1afce355f5343d8135bcadaa0d65fafd2a1e02154fcf48c51a354ab294799c6c0444bfadc792ea195e9b9fdefa0edfde20b547f393f4c05f1e6e32b10da328df10d0b231b5c5af4f0d02bdd3492a095fd7a02b5be79308c127233cec06c203ae54ed2c85b69878eeb13abfc9d6a9aa0af6751551d96ea25ae9afb6113a2c13bef56254c3ea24b1a643562fdbdb4100da0c3b3d7526009039e7cf06279d8226f536ccedbed96da7d3f82aa878063bbeb9aa03dcfed22cae1cee772be285fbba92960fe887eb0997eb9a221849e690b2a6917a05c86e58c113f61d4c44bbe0d6c45ee4d4cdf1ecf308d1f0d43f2a284e0bd1300a03eea9d225bd25dc3dc2d48bf156abc17e6d20686624fa5e93ab8b05f42058e34a0794f702cf0ca4e67ad88a9e9ee7d51adf3b3b3aa47621aa5bf0b8cab433176ec80";
        accountProof[5] =
            hex"f901f1a0605770c9b68c1b4e33579a35850c1c44731852d55172ec379b2377e54c359d9ca0d704783a3e1d333129d0305964be5f1af602b860253deddb80c0b36bb71f697ca0b4c43f62e620af02dbeaf9d0e79b62d30041ef97ceb70190e3a1bfa0711ddd21a0ffc993b4e33b8a39b84563804f7439299ca8cc0ce747625fb160baccaac0ae56a073146beddea840ed57473fa066835ba3f5b4a7a950965aa8b97b55604ad328e280a0461d8ad7f395cfca01b2b5173ac2cbc81f0343061a4cad2d93593b29d91ba9baa067a777686549c4b2408aa78e935a777bc447b5055a778faf62a5dda63f5c274ea0903c36605f0616a74dcbb4730437ffefea698cbef452e19a08072830f25c581fa06ff86e3168eb6b77472acb077d925fd36000139a924531125a1cd469152712d2a048fd7f01074966c50c0a3cc68a53a0ea29410c0f9a37595657493ec9dffcd4e9a02358f5f4c8b91b0b865a8f70f22f9f082aefeccd53776ba835ead842ff9d74a0a03f7d16b8024d3f8cd006b4e6cc69ce07c520178254ebafe68ada722871342257a08e1bf934b22c0a817fb470fb0e8c792fd1987f062a1af318de783df5a9c71081a063d0b5247f4a977839a12223db8c2e6f120ea6f0db673f0fb056415745e8015ba0cca532f0172104741733687ad1b87337f554def14726f29fabc556b070d077cf80";
        accountProof[6] =
            hex"f8518080808080808080808080a04fc082a60fe2f12e75c8d6dddca59133c0e855e7d412ffbaba8c2117d37aa35780a06bd1536769280b725a364161ed10f1737f8b70938227ae1cdda228f45ac1e168808080";
        accountProof[7] =
            hex"f8669d3a74f1d0cadee872fd4b113921a69b6f137711ffc6bc55289ddac192dcb846f8440180a0f7916f389ccda56e3831e115238b7389b30750886785a3c21265601572698f0fa040ed175bbf1e21348615151831ea7a1164fb6d1bd4e1fa03290f0d97bd122021";

        bytes[] memory storageProof = new bytes[](1);
        storageProof[0] =
            hex"e3a1209749684f52b5c0717a7ca78127fb56043d637d81763c04e9d30ba4d4746d56e901";

        vm.expectRevert();
        LibTrieProof.verifyMerkleProof(
            stateRoot, randAddress(), slot, hex"01", accountProof, storageProof
        );

        vm.expectRevert();
        LibTrieProof.verifyMerkleProof(
            stateRoot, address(0), slot, hex"01", accountProof, storageProof
        );

        bytes32 storageRoot = LibTrieProof.verifyMerkleProof(
            stateRoot, addr, slot, hex"01", accountProof, storageProof
        );

        accountProof = new bytes[](0);
        bytes32 storageRoot2 = LibTrieProof.verifyMerkleProof(
            storageRoot, addr, slot, hex"01", accountProof, storageProof
        );

        assertEq(storageRoot2, storageRoot);
    }

    function test_verifyMerkleProof_w_multi_array_StorageProof() public {
        // This one is the "sender app" aka the source bridge but i mocked it for now to be an EOA
        // (for slot calculation)
        address addr = 0x17DF3c450D1dC61558ecA7B10e4bBC8ddcdB1f28;
        // This is the slot i queried the eth_getProof on Sepolia for blockheight: 0x5000B5
        bytes32 slot = 0xfa2ef1bab164a0522c2c110bbea1a54ac6399d3ba24437480c29947143a5402e;
        // This is the stateRoot at blockheight: 0x5000B5 (Sepolia!)
        bytes32 stateRoot = 0x90c5f343ed98545ad5ad4e840492e1008218c0ea92f8fd74a826aaf4c477a3fe;
        // This is the stateRoot just RLP encoded with
        // https://toolkit.abdk.consulting/ethereum#key-to-address,rlp
        // Not needed for now but leave it as is
        //bytes memory stateRootRLPEncoded =
        // hex"e1a090c5f343ed98545ad5ad4e840492e1008218c0ea92f8fd74a826aaf4c477a3fe";

        bytes[] memory accountProof = new bytes[](8);
        // eth_getProof responds some bytes
        accountProof[0] =
            hex"f90211a0a70172b1a602df14e9a59accd22c3b4edfd7b07c42a29437cc70b39938aba4f7a0333ef9d97000e693dd837c3f0720339f9ca0b6cf190b6107a829a5b4e8cffff8a0ef0c84a2a1d5fcbc04ba69dcf078ba3c257ceea69b5180e1a726529eb17dd61ea0d8a96be91d581f326bfaf127d61d641e2bccc4b22f499d420d7f523d3972ef20a0a3d95c18014ae2787b0290b5e9c19b940287443f35d524859331a493e06541dba0f88565aa3b2dd84c6fdc8024255ca7b4033b87f4126558aebb6000ffbf8de6c9a09abceeb595694d4392ac2b8975ee28dedc5ca6d1abf3346986e196f55e4ae95aa0786363274f216b1fbe91e3c200cda761ddf60047f27175878d159cdb81d41cf8a048a4f3e38df4378bd22a0611bdae08de45003965249240cea55d106fb5d8f52ea0c5b7f4fa33410b702bd8a2a19f5b11809884b511fac62a088f827728b4fc2f10a08f5a48f15a6da94c781e82353e4e09c5874e7eb0fec40aadf3fc4ae183f7353ea0620bb2748e058d5bacfc8ab973ff16436812f0e9ddcf1014453f7453e39ec999a09449c8fb7f7ab693914d33de0ffe68eca1f3246ee302d2ded2d81187b9f771fca0a9b857c2a91e783de01d592541bcabad5b6f1c413bc2696721005817b6b81c41a0dc33a565b46adc8a118d1ef4bc4792cfc765d9e80a12898b90d1b4a20b7a237aa0d3fa721cfad6c1110722b9af2cf64c668dd112c90dcdacbc7139aa537b7424c980";
        accountProof[1] =
            hex"f90211a065ae21b2ed2f789cbf5985c1ddd3efa02ba0b67c28e7deb905c042147d30203ea0cc71953c6bdfacdc66d7ab3253cbf75fb8540838859a89e64944a96783906fa2a0b45366933ff3706f5304d662099ee64f4e213013b0fe2f9bec919c3a465357a9a064f8969dea1939290409337e00ce629a58748bfef548c254d4be294753bce933a0abf92173aef826e79e690f6650641675c97ca34f38be8744fdb4343209533147a0c93dbd512193b21db9f6bc864cbf8319a4b5bd4c4f480385efdd4071ca5007bfa074b760bb755e6f89d7f35133510cb88dc960f703bec73465826fe11c330f98b3a02bf60a5b521916d405c7a0fc9b0cf3eb809c4301834728bc44273bf523b0739ba0a002f06c33375985db480db372d2f9e382b00c2c9eb63da295ea817e27062191a04de0681b114afd03eb1e5f765acbec72d396379698e43c5fe2de83e3d4da4c99a05ea94ab372ed10d89d65b06a1f8b7929b3012921f483d0528e9ddae4dc69af5fa0bb5abc40652861a9cd91afd74e2992edb8674017c0106d656481fc28897b776ca0dbd44eca134c817d3c9c4096711a30cef9bdcda03f7e468f668ea3f2b3e884d6a025d919a318995d7354dc1a553f0efcf5816d723065237588338b21c0e636794ea094f1c40840d3d48836e89c982d5b20ac9f8af7de66c51fa2f996866f8452788ba00e9ec0ca98d74c83369af35da745e3d75d33b4c2b20a96fcc51a2b05b9b4c49080";
        accountProof[2] =
            hex"f90211a0dbb6cd2c1c1fdebab5ad0466881e92d92bdda543ee15e84e34b1a55b3a3165a3a0d8fd492a914c453f3ff0a1915d794962bbedaa3fb4a87d6811c9d2e9ab46a51ea01d8ed7a46f0bfa3f7dae4a12ba7772ee9dc5a1c10bb25c7a73703f659bdb6cc6a04c0862d3d971c83a44fdbbfda77593f84a3726fd10b7c9bc0ae7f7fdb963fb9da0c0bd81ebce33e634c8d4ba2415fc122c2906656309a591e57ceddf87d0af4f6ea097e8b78f38dd97bb6cece4c9c446c8861db17c3b5a375a95139ca64d9212173da0dd8af000c0a79c1f4a69add0f0d6ce42fe541c15523e908d222a9f8846c01e04a00e8d1f18175e1426fca888687cd9d73b652e7633c3b945e7a35aedf56a11823fa0c00fb7590b0a11d4ad5ea70768cf4538a0f471e7cfd6fe2bc8f2fa066301e437a089ddfe0c6fcef71a8ae461469f052e6565389bbfbb0840d7ec991bf36d07f1ada06f910708bedb0aa9a593e0c2dfad9bbe1416460451ad2b6bb6b4003c1180d4f7a049bfa959b149084d1e3682f504abe369baa704a48b18c27a6533a4d01c8f6fd0a0e5c1cadca28c1deb270e157465a483e7869c976dbe57ed9df4b67f311494f05ca0f2d3e4af760d0991880537068d331dfc8bac07021b537adc08a7d776963b798ea0cab31688afdff6bdddd88fdbe3e64ff49882d3ee9c4c278915cd9506fd2bae6fa0ef8343de3e3680331774f1156144e179442ef3be7a8f7028240f660bd562b98080";
        accountProof[3] =
            hex"f90211a01510196c2f890bb60eef86a65642598709572c206c6decac65bb6918f1b62cefa0b581e10f79f49e6348f076f20285ed5142d94c3cc140f3e321060ae3faac2a7fa01efd015a8aa5b476e7e772d02e838fd9a212ac1292fe1c9ebbb6dc7982800bf5a05f8f5369390832bebd4e2831eff5edf139a6692bfbfb78815587219ea17d543ea0a0a9fa1979793b984569bb9c39e902fc9cdc768e4b2650b139888ca07105dd62a050c6831d1018f7202d02d233e7f5a7b7faa1cce150223c56f5c260c6539c11d2a091a58d1b5e1670d7d0b294b1f485a9a32a23cc54b08352536f68274121bb6220a0d0b03210469648276152e9b9314389c04d7c0c875aa7dda864dafc28826624b1a036ae04ac68f2e5567c508f4c7c0dee1dde1c866f076cd94bf9486f240ea16f2aa04f9b7975b6dc0250faa2af1748651e70027a9a39760df2ef313a22539144e77ba0a02bc5425da8eeaa4f9f735b1d88ca96b740d842b6ba705228f8904520f7f4aba0654d1a89866c3a42135a29b6c406ccc8964848e36566fef44db7cf570617d9c0a024f77846786885eec88de1b344e90db8828b3c989aefdbe0c2580dc42f1b10a4a0838ad9f2185694bef086711990f4475e848fa0f3652ce57124f60e4100f0992ea0e4becdc5a08dd5e95021fc2e694a32701d2d7e1730f5ab388cfd220842763596a01505d1b994a72b8bae77c9c8741b1988e8ce7f98dc938ee5944161273a21cd7d80";
        accountProof[4] =
            hex"f90211a0f69c09b524b3e7a97fe238809583b7b68f41443a76c0f5d689b371c1df513fc1a0d0f0bcbbd6dae7bd8dd9ba196a34e81c7cc9fea6ac4894a69ec2b5b7bdae2f01a081975fbe995c9a7a55b8e846a70be0d6695c8529b7f564448bf64f2ef25d8c5ca02cd43f9e6fafbe13cc8e845d8c19b51ddc62610119948c635c7e1c9c9998dc22a036edd90e3adb3e83bbb132a4ed0cd364d06966798773991c20498a1c8a0d0737a0fff1f0dd8fabbe879604701d27411cd58958b77383f36db238d003be119fdf99a0aa9e800a54d21e2a349dba4c36a4ca1dcc0ef9e7fe566edcf9ae241c23cf1783a0600d0b0566a09e75bbf3ea2ef219412ebce5eefa744704aae00773fc852a01a9a066a5629e0906e97b6cfbbf24f69a9e166d523d764c7aa85755c7000ed3185f12a019aa0208717ed5314a832809c1e670796fed87a7aaf4fe0a324da4e6a0006108a0570e44ef6fd1385ef65bca7525a9b81b01dab94e81ec3b15fabb5502aeffe6aca05f53ef2c41b598b01722719124e504e98c0af2616e3392be8e1ea7d7ac23188ba03b1c43a7d59e4c565af8d403bf60f284f359bda98c44c967f4555d7e2763a21ba05c86e58c113f61d4c44bbe0d6c45ee4d4cdf1ecf308d1f0d43f2a284e0bd1300a04572fedcc1eb4bdad4f0ae14b8107bb1616f8569dd73563c8b123e66fb0ed477a09443a305d314cb793443eb0465d04dfc70651ca59ace7ab2174f2a2440f5db0980";
        accountProof[5] =
            hex"f901f1a0605770c9b68c1b4e33579a35850c1c44731852d55172ec379b2377e54c359d9ca0d704783a3e1d333129d0305964be5f1af602b860253deddb80c0b36bb71f697ca0b4c43f62e620af02dbeaf9d0e79b62d30041ef97ceb70190e3a1bfa0711ddd21a0ffc993b4e33b8a39b84563804f7439299ca8cc0ce747625fb160baccaac0ae56a073146beddea840ed57473fa066835ba3f5b4a7a950965aa8b97b55604ad328e280a0461d8ad7f395cfca01b2b5173ac2cbc81f0343061a4cad2d93593b29d91ba9baa067a777686549c4b2408aa78e935a777bc447b5055a778faf62a5dda63f5c274ea0903c36605f0616a74dcbb4730437ffefea698cbef452e19a08072830f25c581fa06ff86e3168eb6b77472acb077d925fd36000139a924531125a1cd469152712d2a05a9debb435e78f914a63118005f59a9f925ed75600f16afbb41769c64fc91157a02358f5f4c8b91b0b865a8f70f22f9f082aefeccd53776ba835ead842ff9d74a0a03f7d16b8024d3f8cd006b4e6cc69ce07c520178254ebafe68ada722871342257a08e1bf934b22c0a817fb470fb0e8c792fd1987f062a1af318de783df5a9c71081a063d0b5247f4a977839a12223db8c2e6f120ea6f0db673f0fb056415745e8015ba0cca532f0172104741733687ad1b87337f554def14726f29fabc556b070d077cf80";
        accountProof[6] =
            hex"f8518080808080808080808080a04fc082a60fe2f12e75c8d6dddca59133c0e855e7d412ffbaba8c2117d37aa35780a030d8b8d79376659472fbdff458a6dd86de90fe0d1b87322ff08c6904572a3b09808080";
        accountProof[7] =
            hex"f8669d3a74f1d0cadee872fd4b113921a69b6f137711ffc6bc55289ddac192dcb846f8440180a00e66f063210888ebc0e788b44e3cccd9e8d5545dd1e067b11646f027a352a455a040ed175bbf1e21348615151831ea7a1164fb6d1bd4e1fa03290f0d97bd122021";

        bytes[] memory storageProof = new bytes[](2);
        storageProof[0] =
            hex"f851808080808080808080a0975a3f014f4327c4888214faf0188d7b80bbf53eab9e5d48268203a6d34dece180808080a0f4866524e70f0a9821f3dfe7662a9ddd69ab2da3484d0295836be53c2fd34c078080";
        storageProof[1] =
            hex"e2a03a8bfe0ed27165791e835ec7589f879ea653f4041176e376a0ae8a0b98accda101";

        vm.expectRevert();
        LibTrieProof.verifyMerkleProof(
            stateRoot, randAddress(), slot, hex"01", accountProof, storageProof
        );

        vm.expectRevert();
        LibTrieProof.verifyMerkleProof(
            stateRoot, address(0), slot, hex"01", accountProof, storageProof
        );

        bytes32 storageRoot = LibTrieProof.verifyMerkleProof(
            stateRoot, addr, slot, hex"01", accountProof, storageProof
        );

        accountProof = new bytes[](0);
        bytes32 storageRoot2 = LibTrieProof.verifyMerkleProof(
            storageRoot, addr, slot, hex"01", accountProof, storageProof
        );

        assertEq(storageRoot2, storageRoot);
    }

    function test_jeff_slot_value_not_1() public pure {
        // signal service address on internal testnet l1
        address addr = 0x83e383dec6E3C2CD167E3bF6aA8c36F0e55Ad910;
        // signalService.getStorageSlot(event.srcchainid, event.Raw.Address [the bridge address on
        // L1], event.MsgHash)
        bytes32 slot = 0x07bfd8daaa640fc5f384ee9b5c1f8984e3075701525ff86aa1c6fe62b09fc2bc;
        // block.Root() of the block used to get the proof
        bytes32 stateRoot = 0x0883e3ee355161a08c1696409375ea33f4bb53a9121bc90bc4d69c4f285382aa;

        bytes[] memory accountProof = new bytes[](3);
        // eth_getProof responds some bytes
        accountProof[0] =
            hex"f90211a0f776494ecffe03ad2af2426ee4fb5ae66c012c03ea3955d5b40a52fe7c6b8df6a0ef4a67411e4accae9bbb05bbcc17d036432de4e3ee0b0d02a04ee6a67db9c1a5a06c4c8f2b3206553ec83f1081a6742edff2f7b7830d3ba4166872c4f3f32bae0ba0aa2e8d96490616498fa142ba7c6a628e2839b9b182c9995992ecf1c1d346784fa0f8d7262d0abdf5d084338a640322c4dd45b1484a630331922afa60256917058aa0e49099e467972084cd70025874c6ae0a6841159aec02f39384de2d9ae7460986a02ad2a355fe840ae1bfe7843616d6bb027c1fd478918cc956e0ca7b61ec0044d0a061ec8e714d951772d74765ae997bd25f3982ea8a0c4dda8baa1e47adbd5a3975a039e5f7e8298126da1e7d6f42b1f20846d68ff40dc857b0dd251d2791c0345589a065f4d771a35d862a10b2a2da6d7d6c1e082cd59280cbab1c8e6aaf89069e72dca07851c1d2a801228a1adb24b61a5b4e1d4e12c5043a0af1b1790cd79b281c43a0a031acf4e7bd8cfb52c19cb512fb2578f416cbcf28cd3b4387d7b6107a17d4ff31a09e8def26ad9cf07bfbba2cf4a3fad0fe4075030b9a67acbecbfa5b7bdc8620cca07174a59e7f5b71a1a20f8c4a232100c1303378a7eb5dd523904d5305e20ee7dca0199ae8cd6d2b09717d59b5106ef31b451b30d777296b4afb43db9327117471eca09193465aefe93e209d05f892f77002dd5c2e74d4eed502ebae3acb7db1e33acc80";
        accountProof[1] =
            hex"f8f1a0b4df476cf7a24306eb6b96d0a8fe974b88e035d93e6716cf56e3f6bacee15c88808080a09265834cbd374b79cc4f97cdab16770f4434bce18ff9724970bff1c91d54f2f1a0e13b8847e8cfc7fd465a61a64b732d940d8f87ed65828e1004e46fb4256aba48a05a7b35dc9c135fc4df95c4b02179719a3505d201fb590212cf41c31eae1ceb6980a07c46a7878ac08b149792973e8a17982311f3c997624aed0fde76ba45d9a1ba41a0ebfe5b284e549d79c976f878d93266d238d9ea3254d0ef9c199d2c5a12067de48080a05d5e60bc5b531718ba65199b06b68087c640472ef4b3afb7e4b857280edbf2e580808080";
        accountProof[2] =
            hex"f869a02024e130452851ed161bc592f5949e62d0e9b45d447bdfeef098148a98e92454b846f8440180a09a86a68eec0b73092dc0028cb4afb05332e85df8af2c9b0f67bbb750a4ada35da0dc679fd48cf611aa38e906adc93928c5f8f6fae534978ea2fa4f5935f5ed1b2c";

        bytes[] memory storageProof = new bytes[](5);
        storageProof[0] =
            hex"f90211a062880ba06fb396ad4e16f01d22ca7a1ae677e3fe428817928db30e2cae96b97ca0aa57a805600be2304ffdd527bd3dc9e91161233dc59afb71c1aab542eafe70caa03bc6c86a4c6b49305b95b3812a162f7e6bec891b287ef291e9c468071ef0c4ada08ac85ec9872d9e6f5b4c6e72154158df88d44163457cf0bbf2134e385c871a4ea0f35f3c83fbd9da738bbfea1bc87b073d3b64abdecb6294b61cf3eb535eabefdea0905c9b0e1755d389f306f026ccb71f8f7e54cd68720cc1c76682504eeb7bceaea06867477d77649657f698380e66844a7ed14818e8aad9f4ac5748963ede640e0aa0caa272deb3227cb8b0765a718ac85bbc7ee93a04bc0a2cb9c5509c9394470eb3a01689508cc26d870b0183c13bee39ed5342bf32464813f872d7ea4e5bc5f79845a0b578886ee673adcdf7b219cd13d9d641f8e15dd9ec6c9345435e7968bc6bcc82a0fbd86d32d6c60089268373be401211c3b606efeb550659b9e43458007dce2eb6a035d73d30ad77c85ef247ab8473f71314a9d175c1e9a0ce73a78a103a3766f54ca0c08386bed5af43c7cadb42d9df7ba3b94886f483e8a2e66aaef7391a15ab51cba002ce1e689b6193a6d3a8c822b0b0076dfdf732fd045a4dc122ec3879fe3de70ea0db27c27a802c40acbde50e5c357e5327a91242e6550fe461eec10ac136ddddcea0ad6d871b4c62042c68f0ecfdb986a24ea7d850563bbd3d27f6916bc3ddd170a480";
        storageProof[1] =
            hex"f90211a05c9b8f83e3c03e07271225e2ebce1cbe9e7db3b14d2724ec6efe9cf8fce6fc06a0dbd4cd41e027eefe208271111ea3e99cb39b4645e7e166d084d62f427a9313ada0cc65078735257beecceb9c74985901fa16e8e9fb228ce6aaa62aedb282a1795fa012f4c2ae88c8f0396048da6a095d0fa2c8b86398651cd37a72d68d88d25ff19ea037cda349771733bba3681eda450fee72f5e3dcbb6b8f2acf4a2bd145d0bfad6da0ef1359be1a9f658e580c968b92029dbf62ce7a56932c10acce28b25bf7206665a037d9790673a2be78a1555bee7d37ab10d1b8d94d1f12bb011b7cc7257bf13004a0dd9b4774c203afaaeb098ab623ce32f1df6f8ff0ac1bbcb78e358b7a242cd19aa0dde51d1f37baae98d02b2e35c81030f17407fc31304ab72cf999bb2c7e8abff3a0f8672c12a366e074d6f42c2c7b0c5cc010bc4ec703c65e3b58c4fbfee18e89c2a057ba424e40bd1c6a8e7d494703f392e834d8ca7696759e2c0216ebd18bcf662fa01eafd299e8a772c056e6919eeb67bf7e1098129855234e942cfc18aaf364d39ea0df6b60bdf553e1511f445fdcf1fb7aadc23bf390eeb11145c9e2742552c2ed6da02e79f5afb8c177c40737cea4aed39fe3c0269f5a8989e02c07a0135594b83bb1a035535dac85afa0e4848c0186cc8687bc7d2de0215b97ea43e65c8e4da0a52517a08ce682327123eb41b4d49ef283ffe11d1da1b9d7163e892b775a63dd31072ec080";
        storageProof[2] =
            hex"f90211a0f40a5ee1ce9d240682f7f7af3c5950bba267b4b78e46c954d2b0f8d77da43a23a058e05fe5ccced350c75f8d4c495cd3db51c2d6215573df35178e32ddd7458ff9a06ce4c63e3b3d650248fe6b8d4efb02f5e460406a006ce732318cd5907a54625ba0b0c5eb8747f10eba341df8f0be99a8433654a4621cd0fcbd6ea24f6a5c3d3a82a0e98d81a5b3bc5f25ea24671e6b947bf2aa68c093d7c3bc946b6e71beb9f46df3a00b51ebdd2337cce7ae87e81412c668d305aefcfe25bbb46cc80b48520844adafa0312ebc38d28bbbcf414ed6c48cfb94d26be82bebf06795ca1ed8f088e340210fa066babdf1ddd352c84662fc3ba586a8dc1048bb4d99eea14b62cb389bff71e6fda08e9bde33f5da83fd3fbdc2c1358c67e321fccce1633039c44a689231a38c3a5ca0cc1d1601726ab0b999cf08fe2a87c29e480c97cb501601591c9a9cf0a0ab63dea0a6547a4b3a8647df43e5b81c5224284d4bf19bab142ed58fb28f5a7ff768ee2ca0b804617fff71909c150ae899e64c3cc07c73ea0b92e32a6033ce84a94a78cea9a0a207d46501ca64b8e3514b071d220f38eb545347cb1837f7acbf801d4e3f20fca0083b56370fe68526c7a36714ddb3e98c0ffc8c3d653e254de50e81a6548ddf03a057777667c151137326519774b769a478fa2f1a95df75e70f8972de7a50e25613a061aa71f8b8ea84ea22ed462f83cda58656815a941b458247f14f26b9f7104e1980";
        storageProof[3] =
            hex"f9013180a0bc1d276fab8bdca46e499a62df0598844a81dd822e5873a57cda01191549b1fca02e7323a53a6103bb95f23070328af116852a340bb8ce85780414f0ee46930f52a0632f43d1fd3bdd8d2e603fca74d2af51c60c1d23fe64cddb02a983779a4bacf1a011d0b3e5a1f1a3dd42b6f6ac95bd34a8044a25a5e99e33cebf730333438047438080a09937213f98b982f56a05cf65bf9113618da12308da8bf5a95c715456d0b91a0ca013844416bff2fdea9d9419e88f58a78728c14bd4e7ba678545ad33224bbea4f080a0de8762bd1bb07b389404f9d925f3bff2f6ea8675b8e89d089cfad9e21f2384b180a0e2be312f35cc32b95912918aa41fbd324a21b7a4acb39fc349b1e4768ca56e9080a052b7d13546e19995f0a3a422a980b8ff101be9494a68562c1e5266933ed25f7b8080";
        storageProof[4] =
            hex"f8429f20228b7509ed753c777c7f96e7105bab2dc7c2ceacb0ff8611edbd2189f583a1a00a793aea9233fc987a8f710991f16b576e23b67a15874faab4e18192aad8fd17";

        LibTrieProof.verifyMerkleProof(
            stateRoot,
            addr,
            slot,
            hex"0a793aea9233fc987a8f710991f16b576e23b67a15874faab4e18192aad8fd17",
            accountProof,
            storageProof
        );
    }
}
